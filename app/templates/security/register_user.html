{% extends "security/base.html" %}
{% from "security/_macros.html" import render_field_with_errors, render_field %}

{% block styles %}
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">

    <!-- Style -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <link rel="apple-touch-icon" href="{{ url_for('static', filename='assets/img/logoChacharitas.png') }}">
    <link rel="shortcut icon" type="image/x-icon"
          href="{{ url_for('static', filename='assets/img/logoChacharitas.png') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/templatemo.css') }}">
{% endblock %}

{% block body %}
    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-5 order-md-2">
                    <img src="{{ url_for('static', filename='images/undraw_file_sync_ot38.svg') }}" alt="Image"
                         class="img-fluid">
                </div>
                <div class="col-md-7 contents">
                    <div class="row justify-content-center">
                        <div class="col-md-12">
                            <div class="form-block">
                                <div class="mb-4">
                                    <h3>{{ _fsdomain('Registrate en') }} <strong>Chacharitas</strong></h3>
                                    <p class="mb-4">{{ _fsdomain('Empieza tu vida sustentable') }}</p>
                                </div>

                                <form id="register_form" action="{{ url_for_security('register') }}" method="POST">
                                    {{ register_user_form.hidden_tag() }}
                                    <div class="form-group first mb-5">
                                        <div class="row">
                                            <div class="col-md-4">
                                                {{ render_field_with_errors(register_user_form.username, class="form-control", id="username", autocomplete="off") }}
                                            </div>
                                            <div class="col-md-8">
                                                {{ render_field_with_errors(register_user_form.email, class="form-control", id="email") }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group mb-5">
                                        {{ render_field_with_errors(register_user_form.us_phone_number, class="form-control", id="us_phone_number") }}
                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-6">
                                                {{ render_field_with_errors(register_user_form.password, class="form-control", id="password") }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ render_field_with_errors(register_user_form.password_confirm, class="form-control", id="password_confirm") }}
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-pill text-white btn-block btn-primary" type="submit">
                                        {{ _fsdomain('Registrarse') }}
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block scripts %}
        <script>
            document.getElementById('register_form').addEventListener('submit', function (event) {
                event.preventDefault();
                var registerForm = this;

                // Submit the registration form
                fetch(registerForm.action, {
                    method: 'POST',
                    body: new FormData(registerForm)
                }).then(function (response) {
                    if (response.ok) {
                        // Redirect to /confirm
                        window.location.href = '/confirm';
                    } else {
                        // Handle registration form errors
                        response.text().then(function (text) {
                            console.error('Registration failed:', text);
                        });
                    }
                }).catch(function (error) {
                    console.error('Error:', error);
                });
            });
        </script>
    {% endblock %}
{% endblock %}
